bundle:
  name: pixels-demo

workspace:
  root_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/my-envs/${bundle.target}

variables:
  # Project name - replace with your solution accelerator name
  project_name:
    description: "DICOM Medical Imaging dbdemo"
    default: "pixels"

  catalog:
    description: "Catalog containing the Pixels object_catalog table"
    default: "main"

  schema:
    description: "Schema containing the Pixels object_catalog table"
    default: "pixels_solacc"

  table:
    default: "main.pixels_solacc.object_catalog"
 
  volume:
    default: "pixels_volume"

  serving_endpoint_name:
    default: pixels-monai-uc

  # The "sql_warehouse" variable is used to reference the warehouse used by the dashboard.
  sql_warehouse:
    lookup:
      # Replace this with the name of your SQL warehouse.
      warehouse: "Serverless Starter Warehouse"
      
  # Environment variable used for deployment paths
  environment:
    description: "Deployment environment (dev, staging, prod)"
    default: "dev"


# These are any additional files or paths to include or exclude.
sync:
  paths:
    - ../..
  exclude:
    - ../../images/*.gif
    - ../../monailabel_model/vista3d/code/vista3d_bundle/vista3d/**/*
    - ../../monailabel_model/vista3d/code/vista3d_bundle/assets/**/*

targets:
  dev:
    default: true
    mode: development
    presets:
      source_linked_deployment: false


  prod:
    default: false
    mode: production
    presets:
      source_linked_deployment: false
    workspace:
      root_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}

resources:
  schemas:
    pixels_schema:
      name: ${var.schema}
      catalog_name: ${var.catalog}
      comment: 'This schema created by Pixels dbdemos'
      grants:
        - privileges:
          - SELECT
          principal: "account users"
  
  volumes:
    pixels_volume:
      name: ${var.volume}
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      comment: "Store segmentation files"
      grants:
        - privileges:
          - READ_VOLUME
          principal: "account users"

  dashboards:
      pixels_dashboard:
          display_name: 'Pixels Medical Imaging Cohorts'
          file_path: "../../ai-bi/Pixels Object Catalog dashboard.lvdash.json"
          warehouse_id: ${var.sql_warehouse}
          permissions: 
            - level: CAN_RUN
              group_name: "account users"
  
  apps:
    pixels_ohif_viewer:
      name: pixels-viewer-v2-${bundle.target}
      description: 'Databricks Pixels OHIF viewer for Medical Imaging'
      source_code_path: /Workspace/Users/${workspace.current_user.userName}/.bundle/${bundle.name}/${bundle.target}/files/dbx/pixels/resources/lakehouse_app
      resources:
        - name: "sql_warehouse"
          description: "A SQL warehouse for app to be able to work with"
          sql_warehouse:
            id: ${var.sql_warehouse}
            permission: "CAN_USE"
      user_api_scopes: ["sql", "files.files"] # This give the user access to the SQL warehouse
      

  jobs:
    pixels_demo_ingest:
      name: Pixels Ingest
      description: Pixels Medical Imaging DICOM Ingestion Job
      timeout_seconds: 7200
      tasks:
        - task_key: 01-dcm-demo
          notebook_task:
            notebook_path: ../../01-dcm-demo.py
            source: WORKSPACE
      tags:
        accelerator: pixels
        group: HLS
        usage: solacc_testing
      parameters:
        - name: table
          default: ${var.table}
        - name: volume
          default: ${var.catalog}.${var.schema}.${var.volume}

      
