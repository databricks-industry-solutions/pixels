"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[121],{23121:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(41766),r=n(11374),s=n.n(r),o=n(14283),i=n(21683);const l={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const c=function({servicesManager:e,rtDisplaySet:t,viewportId:n,toolGroupId:a="default",preHydrateCallbacks:r,hydrateRTDisplaySet:s}){const{uiViewportDialogService:o}=e.services;return new Promise((async function(c,u){const p=await function(e,t){return new Promise((function(n,a){const r="Do you want to open this Segmentation?",s=[{type:i.Ny.NW.secondary,text:"No",value:l.CANCEL},{type:i.Ny.NW.primary,text:"Yes",value:l.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:r,actions:s,onSubmit:o,onOutsideClick:()=>{e.hide(),n(l.CANCEL)}})}))}(o,n);if(p===l.HYDRATE_SEG){r?.forEach((e=>{e()}));c(await s({rtDisplaySet:t,viewportId:n,toolGroupId:a,servicesManager:e}))}}))};var u=n(80619);const p=function(e,t,n){const{tools:a}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,a)};function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}const{formatDate:m}=o.utils;function S(e){const{children:t,displaySets:n,viewportOptions:r,viewportLabel:s,servicesManager:l,extensionManager:S,commandsManager:y}=e,{displaySetService:g,toolGroupService:v,segmentationService:E,uiNotificationService:f,customizationService:w}=l.services,I=r.viewportId,D=`RTToolGroup-${I}`;if(n.length>1)throw new Error("RT viewport should only have a single display set");const b=n[0],[h,T]=(0,i.ih)(),[N,C]=(0,a.useState)(!1),[k,P]=(0,a.useState)(1),[x,A]=(0,a.useState)(b.isHydrated),[R,M]=(0,a.useState)(!b.isLoaded),[O,G]=(0,a.useState)(null),[U,L]=(0,a.useState)({percentComplete:null,totalSegments:null}),V=(0,a.useRef)(null),{viewports:_,activeViewportId:H}=h,j=b.getReferenceDisplaySet(),F=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(j);V.current={displaySet:j,metadata:F};const Y=e=>{G(e.detail.element)},B=()=>{G(null)},$=(0,a.useCallback)((()=>{h?.viewports.forEach((({viewportId:e})=>{y.runCommand("storePresentation",{viewportId:e})}))}),[h]),q=({rtDisplaySet:e,viewportId:t})=>{y.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})},W=(0,a.useCallback)((()=>{const{component:t}=S.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=V.current;return a.createElement(t,d({},e,{displaySets:[n,b],viewportOptions:{viewportType:"volume",toolGroupId:D,orientation:r.orientation,viewportId:r.viewportId},onElementEnabled:Y,onElementDisabled:B}))}),[I,b,D]),z=(0,a.useCallback)((e=>{e="left"===e?-1:1;const t=b.displaySetInstanceUID,n=E.getSegmentation(t),{segments:a}=n,r=Object.keys(a).length;let s=k+e;s>=r-1?s=1:0===s&&(s=r-1),E.jumpToSegmentCenter(t,s,D),P(s)}),[k]);(0,a.useEffect)((()=>{R||c({servicesManager:l,viewportId:I,rtDisplaySet:b,preHydrateCallbacks:[$],hydrateRTDisplaySet:q}).then((e=>{e&&A(!0)}))}),[l,I,b,R]),(0,a.useEffect)((()=>{const{unsubscribe:e}=E.subscribe(E.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.rtDisplaySet.displaySetInstanceUID===b.displaySetInstanceUID&&M(!1),e.overlappingSegments&&f.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[b]),(0,a.useEffect)((()=>{const{unsubscribe:e}=E.subscribe(E.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{L({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[b]),(0,a.useEffect)((()=>{const e=g.subscribe(g.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=_.get(H);e.includes(t.displaySetInstanceUID)&&T.setDisplaySetsForViewport({viewportId:H,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,a.useEffect)((()=>{let e=v.getToolGroup(D);if(!e)return e=p(v,w,D),C(!0),()=>{E.removeSegmentationRepresentationFromToolGroup(D),v.destroyToolGroup(D)}}),[]),(0,a.useEffect)((()=>(A(b.isHydrated),()=>{E.removeSegmentationRepresentationFromToolGroup(D),V.current=null})),[b]);let J=null;if(!V.current||j.displaySetInstanceUID!==V.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(J=t.map(((e,t)=>e&&a.cloneElement(e,{viewportId:I,key:t}))));const{PatientID:K,PatientName:Q,PatientSex:X,PatientAge:Z,SliceThickness:ee,ManufacturerModelName:te,StudyDate:ne,SeriesDescription:ae,SpacingBetweenSlices:re,SeriesNumber:se}=V.current.metadata,oe=async()=>{$();const e=await q({rtDisplaySet:b,viewportId:I});A(e)};return a.createElement(a.Fragment,null,a.createElement(i.cS,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:z,getStatusComponent:()=>function({isHydrated:e,onStatusClick:t}){let n=null,r=null;const{t:s}=(0,u.Bd)("Common"),o=s("LOAD");switch(e){case!0:r=()=>a.createElement(i.In,{name:"status-alert"}),n=()=>a.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:r=()=>a.createElement(i.In,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>a.createElement("div",null,"Click LOAD to load RTSTRUCT.")}const l=()=>a.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},a.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},a.createElement(r,null),a.createElement("span",{className:"ml-1"},"RTSTRUCT")),!e&&a.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},o));return a.createElement(a.Fragment,null,n&&a.createElement(i.m_,{content:a.createElement(n,null),position:"bottom-left"},a.createElement(l,null)),!n&&a.createElement(l,null))}({isHydrated:x,onStatusClick:oe}),studyData:{label:s,useAltStyling:!0,studyDate:m(ne),currentSeries:se,seriesDescription:`RT Viewport ${ae}`,patientInformation:{patientName:Q?o.Ay.utils.formatPN(Q.Alphabetic):"",patientSex:X||"",patientAge:Z||"",MRN:K||"",thickness:ee?`${ee.toFixed(2)}mm`:"",spacing:void 0!==re?`${re.toFixed(2)}mm`:"",scanner:te||""}}}),a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},R&&a.createElement(i.pT,{className:"h-full w-full",totalNumbers:U.totalSegments,percentComplete:U.percentComplete,loadingText:"Loading RTSTRUCT..."}),W(),J))}S.propTypes={displaySets:s().arrayOf(s().object),viewportId:s().string.isRequired,dataSource:s().object,children:s().node,customProps:s().object},S.defaultProps={customProps:{}};const y=S}}]);
//# sourceMappingURL=121.bundle.d6dcf45d170ddcc41c9d.js.map